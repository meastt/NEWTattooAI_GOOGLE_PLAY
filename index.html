<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no" />
  <title>InkPreview - Preview Before You Ink</title>
  <meta name="description"
    content="Transform your tattoo ideas into reality with AI-powered design generation, virtual try-ons, and removal previews." />

  <!-- Custom Fonts - Bold Industrial Typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // Force header and footer to stay fixed
    function enforceFixedPositioning() {
      const header = document.querySelector('header');
      const nav = document.querySelector('nav');

      if (header) {
        header.style.setProperty('position', 'fixed', 'important');
        header.style.setProperty('top', '0px', 'important');
        header.style.setProperty('left', '0px', 'important');
        header.style.setProperty('right', '0px', 'important');
        header.style.setProperty('width', '100%', 'important');
        header.style.setProperty('z-index', '50', 'important');
        header.style.setProperty('transform', 'translateZ(0)', 'important');
      }

      if (nav) {
        nav.style.setProperty('position', 'fixed', 'important');
        nav.style.setProperty('bottom', '0px', 'important');
        nav.style.setProperty('left', '0px', 'important');
        nav.style.setProperty('right', '0px', 'important');
        nav.style.setProperty('width', '100%', 'important');
        nav.style.setProperty('z-index', '9999', 'important');
        nav.style.setProperty('transform', 'translateZ(0)', 'important');
        nav.style.setProperty('isolation', 'isolate', 'important');
        nav.style.setProperty('contain', 'layout style paint', 'important');
      }
    }

    // Run on page load
    document.addEventListener('DOMContentLoaded', enforceFixedPositioning);

    // Run after any content changes
    const observer = new MutationObserver(enforceFixedPositioning);
    observer.observe(document.body, {
      childList: true,
      subtree: true,
      attributes: true,
      attributeFilter: ['style', 'class']
    });

    // Run more frequently to ensure positioning stays fixed
    setInterval(enforceFixedPositioning, 100); // Run every 100ms instead of 1000ms

    // Specifically watch for image loads that might break the footer
    document.addEventListener('load', function (e) {
      if (e.target.tagName === 'IMG') {
        setTimeout(enforceFixedPositioning, 50); // Fix positioning after image loads
        // Also force a reflow to prevent layout shifts
        setTimeout(() => {
          document.body.style.transform = 'translateZ(0)';
          setTimeout(() => {
            document.body.style.transform = '';
          }, 10);
        }, 10);
      }
    }, true);

    // Watch for any scroll events that might affect positioning
    let scrollTimeout;
    window.addEventListener('scroll', function () {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(enforceFixedPositioning, 10); // Fix positioning after scroll
    });

    // Virtual keyboard detection and handling
    let initialViewportHeight = window.innerHeight;
    let isKeyboardOpen = false;

    function handleViewportChange() {
      const currentHeight = window.innerHeight;
      const heightDifference = initialViewportHeight - currentHeight;

      // If height decreased significantly, keyboard is likely open
      if (heightDifference > 150) {
        if (!isKeyboardOpen) {
          isKeyboardOpen = true;
          console.log('Virtual keyboard opened');
          // Force header and nav to stay fixed
          enforceFixedPositioning();
        }
      } else {
        if (isKeyboardOpen) {
          isKeyboardOpen = false;
          console.log('Virtual keyboard closed');
          // Force header and nav to stay fixed after keyboard closes
          setTimeout(enforceFixedPositioning, 100);
          setTimeout(enforceFixedPositioning, 300);
          setTimeout(enforceFixedPositioning, 500);
        }
      }
    }

    // Listen for viewport changes (keyboard events)
    window.addEventListener('resize', handleViewportChange);
    window.addEventListener('orientationchange', function () {
      setTimeout(() => {
        initialViewportHeight = window.innerHeight;
        enforceFixedPositioning();
      }, 500);
    });

    // Handle input focus/blur events
    document.addEventListener('focusin', function (e) {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
        console.log('Input focused');
        setTimeout(enforceFixedPositioning, 100);
      }
    });

    document.addEventListener('focusout', function (e) {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
        console.log('Input blurred');
        setTimeout(enforceFixedPositioning, 100);
        setTimeout(enforceFixedPositioning, 300);
        setTimeout(enforceFixedPositioning, 500);
      }
    });

    // Handle visual viewport API if available (more accurate)
    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize', function () {
        console.log('Visual viewport changed');
        setTimeout(enforceFixedPositioning, 50);
        setTimeout(enforceFixedPositioning, 200);
      });
    }
  </script>
  <script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.16.0"
  }
}
</script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>

</html>